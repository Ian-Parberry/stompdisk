<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>StompDisk: StompDisk</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">StompDisk
   </div>
   <div id="projectbrief">Create Hugemungous Files of Zeros Fast</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">StompDisk </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>1. Introduction</h2>
<p >When you delete a file under Windows, the file data on disk doesn't get deleted, just the pointers that Windows uses to access the file. The data is still there, but its location on the disk has been added to a <em>free-list</em> of disk space available to be over-written by other files. Until that disk space is actually over-written by another file, a moderately competent hacker with access to your old disk drive could potentially reconstruct your files. This means that before you sell, give away, or throw out your old computer or your old disk drive, it's a good idea to over-write as much of the data on the disc as you can with something innocuous, such as all zeros (note that I mean the zero byte <code>0x00</code>, not the zero character <code>0x30</code>).</p>
<p >The obvious way to create a large file of zero bytes in <code>C++</code> under Windows might start with these <code>#include</code>s:</p>
<pre style="color:#000020;background:#f6f8ff;"><span style="color:#004a43; ">#</span><span style="color:#004a43; ">include </span><span style="color:#800000; ">&lt;</span><span style="color:#40015a; ">cstdint</span><span style="color:#800000; ">&gt;</span>
<span style="color:#004a43; ">#</span><span style="color:#004a43; ">include </span><span style="color:#800000; ">&lt;</span><span style="color:#40015a; ">cstdio</span><span style="color:#800000; ">&gt;</span>
<span style="color:#004a43; ">#</span><span style="color:#004a43; ">include </span><span style="color:#800000; ">"</span><span style="color:#40015a; ">Windows.h</span><span style="color:#800000; ">"</span>
</pre><p >Create a byte buffer <code>pBuffer</code> of size <code>nSize</code> some multiple of the disk block size (we'll use <code>1073741824</code>, which is 1GB, in this example):</p>
<pre style="color:#000020;background:#f6f8ff;"><span style="color:#200080; font-weight:bold; ">const</span> uint64_t nSize <span style="color:#308080; ">=</span> <span style="color:#008c00; ">1073741824</span><span style="color:#406080; ">;</span> <span style="color:#595979; ">//buffer size</span>
uint8_t<span style="color:#308080; ">*</span> pBuffer <span style="color:#308080; ">=</span> new uint8_t<span style="color:#308080; ">[</span>nSize<span style="color:#308080; ">]</span><span style="color:#406080; ">;</span> <span style="color:#595979; ">//buffer</span>
</pre><p >Fill it with zeros using the Windows API function <code>ZeroMemory</code>:</p>
<pre style="color:#000020;background:#f6f8ff;"><span style="color:#400000; ">ZeroMemory</span><span style="color:#308080; ">(</span><span style="color:#308080; ">&amp;</span>pBuffer<span style="color:#308080; ">,</span> nSize<span style="color:#308080; ">)</span><span style="color:#406080; ">;</span> <span style="color:#595979; ">//fill buffer with zeros</span>
</pre><p >Output it to a file <code>stomp0.bin</code> in one chunk using the <code>stdio</code> function <code>fwrite</code>:</p>
<pre style="color:#000020;background:#f6f8ff;"><span style="color:#003060; ">FILE</span><span style="color:#308080; ">*</span> pFile <span style="color:#308080; ">=</span> <span style="color:#003060; ">fopen</span><span style="color:#308080; ">(</span><span style="color:#800000; ">"</span><span style="color:#1060b6; ">stomp0.bin</span><span style="color:#800000; ">"</span><span style="color:#308080; ">,</span> <span style="color:#800000; ">"</span><span style="color:#1060b6; ">wb</span><span style="color:#800000; ">"</span><span style="color:#308080; ">)</span><span style="color:#406080; ">;</span> <span style="color:#595979; ">//open output file</span>

<span style="color:#200080; font-weight:bold; ">if</span><span style="color:#308080; ">(</span>pFile<span style="color:#308080; ">)</span><span style="color:#406080; ">{</span> <span style="color:#595979; ">//open file successful</span>
  <span style="color:#003060; ">fwrite</span><span style="color:#308080; ">(</span>pBuffer<span style="color:#308080; ">,</span> <span style="color:#200080; font-weight:bold; ">sizeof</span><span style="color:#308080; ">(</span>uint8_t<span style="color:#308080; ">)</span><span style="color:#308080; ">,</span> nSize<span style="color:#308080; ">,</span> pFile<span style="color:#308080; ">)</span><span style="color:#406080; ">;</span> <span style="color:#595979; ">//write zeros</span>
  <span style="color:#003060; ">fclose</span><span style="color:#308080; ">(</span>pFile<span style="color:#308080; ">)</span><span style="color:#406080; ">;</span> <span style="color:#595979; ">//close file</span>
<span style="color:#406080; ">}</span> <span style="color:#595979; ">//if</span>
</pre><p >Remember to clean up afterwards:</p>
<pre style="color:#000020;background:#f6f8ff;">delete [] pBuffer<span style="color:#406080; ">;</span>
</pre><p >The above code is pretty much cross-platform (meaning that you could probably get it to compile with <code>g++</code> under a <code>*NIX</code> variant with some small changes such as replacing the call to <code>ZeroMemory</code> with a <code>memset</code>), but it has a major drawback. It is horribly, unecessarily, and annoyingly slow, even if you have a reasonably recent computer with oodles of memory and a solid state drive. There are many things you can try such as optimizing the block size and writing consecutive blocks of zeros by putting the <code>fwrite</code> line into a <code>for</code>-loop, but it will remain slow despite your efforts because there's no way to get around the fact that you are moving large blocks of data from memory over the bus to the disk drive. Or is there? Actually, there is a much faster way to create a large file of zeros under Windows as follows.</p>
<pre style="color:#000020;background:#f6f8ff;"><span style="color:#003060; ">LARGE_INTEGER</span> nSize<span style="color:#406080; ">;</span> <span style="color:#595979; ">//thanks for being weird, Microsoft</span>
nSize<span style="color:#308080; ">.</span>QuadPart <span style="color:#308080; ">=</span> <span style="color:#008c00; ">1073741824</span><span style="color:#406080; ">;</span> 

<span style="color:#200080; font-weight:bold; ">const</span> <span style="color:#003060; ">HANDLE</span> hFile <span style="color:#308080; ">=</span> <span style="color:#400000; ">CreateFile</span><span style="color:#308080; ">(</span><span style="color:#800000; ">L"</span><span style="color:#1060b6; ">stomp0.bin</span><span style="color:#800000; ">"</span><span style="color:#308080; ">,</span> <span style="color:#7d0045; ">GENERIC_WRITE</span><span style="color:#308080; ">,</span>
  FILE_SHARE_WRITE<span style="color:#308080; ">,</span> <span style="color:#7d0045; ">NULL</span><span style="color:#308080; ">,</span> <span style="color:#7d0045; ">CREATE_ALWAYS</span><span style="color:#308080; ">,</span> FILE_ATTRIBUTE_NORMAL<span style="color:#308080; ">,</span> <span style="color:#7d0045; ">NULL</span><span style="color:#308080; ">)</span><span style="color:#406080; ">;</span>

<span style="color:#200080; font-weight:bold; ">if</span><span style="color:#308080; ">(</span><span style="color:#003060; ">SUCCEEDED</span><span style="color:#308080; ">(</span>dwErr<span style="color:#308080; ">)</span><span style="color:#308080; ">)</span><span style="color:#406080; ">{</span> <span style="color:#595979; ">//file has been opened, hFile is valid</span>
  SetFilePointerEx<span style="color:#308080; ">(</span>hFile<span style="color:#308080; ">,</span> nSize<span style="color:#308080; ">,</span> <span style="color:#008c00; ">0</span><span style="color:#308080; ">,</span> FILE_BEGIN<span style="color:#308080; ">)</span><span style="color:#406080; ">;</span> <span style="color:#595979; ">//set file ptr to start of file</span>
  <span style="color:#400000; ">SetEndOfFile</span><span style="color:#308080; ">(</span>hFile<span style="color:#308080; ">)</span><span style="color:#406080; ">;</span> <span style="color:#595979; ">//set end of file</span>
  <span style="color:#400000; ">CloseHandle</span><span style="color:#308080; ">(</span>hFile<span style="color:#308080; ">)</span><span style="color:#406080; ">;</span> <span style="color:#595979; ">//close handle</span>
<span style="color:#406080; ">}</span> <span style="color:#595979; ">//if</span>
</pre><p >Notice that there is no buffer of zeros and no moving large chunks of data. The zero-ing out of the data on disk is apparently carried out by the call to the Windows API function <code>SetFilePointerEx</code>. You'll find this code in function <a class="el" href="_main_8cpp.html#ae7a7e7f545dc3168da5ec3be08abcac0" title="Create files of zeros.">Stomp()</a>. The rest of the code in <a class="el" href="_main_8cpp.html" title="The only code file.">Main.cpp</a> is just I/O, prettifying, and error-checking.</p>
<h2>2. Compiling the Code</h2>
<p >A Visual Studio solution file <code>stompdisk.sln</code> has been provided in the root folder. It has been tested with Visual Studio 2019 Community under Windows 10.</p>
<h2>3. Using the Code</h2>
<p ><code>StompDisk</code> compiles to a Windows Console program that prompts for the file size in GB (Gigabytes) and the number of files to create. The files will be named <code>stomp0.bin</code>, <code>stomp1.bin</code>, <code>stomp2.bin</code>, etc. If you already have some files named <code>stomp*.bin</code> in the current folder, then they will not be over-written. The <a class="el" href="index.html#fig1">Fig. 1</a> below shows a screen shot.</p>
<p ><a class="anchor" id="fig1"></a></p><div class="image">
<img src="sshot.png" alt="" width="40%"/>
<div class="caption">
Fig. 1: Screen shot of StompDisk.</div></div>
<p >It is <em>strongly recommended</em> that you do not open any of the <code>stomp*.bin</code> files in a text editor such as <code>Notepad</code> or <code>Notepad++</code> unless you are willing to wait a very, very long time for it to load. If you want to check one of the output files to see that it contains zeros, I suggest that you use the free hex editor <a href="https://mh-nexus.de/en/hxd/">HxD</a>. For example, <a class="el" href="index.html#fig2">Fig. 2</a> shows <code>stomp0.bin</code> open in <a href="https://mh-nexus.de/en/hxd/">HxD</a>.</p>
<p ><a class="anchor" id="fig2"></a></p><div class="image">
<img src="hxd.png" alt="" width="50%"/>
<div class="caption">
Fig. 2: Screen shot of HxD.</div></div>
<h3>Before Disposing of Your Disk Drive or Computer</h3>
<p >Before you dispose of your disk drive or computer, you should of course delete all of your files from the usual places such as the <code>Documents</code> and <code>Pictures</code> folders. The best way to delete them is to select them in Windows Explorer and press <code>Shift+Delete</code>. Note that these files cannot be undeleted, so make sure that you do <em>really</em> want to do this. You should also uninstall any unnecessary programs that may be caching data, clear all browser cookies and downloaded files, and empty the trash.</p>
<p >Once you are sure that you have deleted everything that can be deleted, use <code>StompDisk</code> to create a collection of progressively smaller files until your disk drive shows up as nearly full. If you choose to do this, be aware that Windows tends to get increasing slow and tetchy as its main drive gets close to 100 percent usage. After, and only after, you have created enough <code>stomp*.bin</code> files to fill the disk you should delete them all, again preferably using <code>Shift+Delete</code>. Your unused disk space should now mostly consist of zeros.</p>
<p ><span style="color: red;"> Important Note: <code>StompDisk</code> is not guaranteed to over-write absolutely all of your data. There may still be fragments of deleted files remaining depending on a number of factors including the sizes of the files that are still on your disk. If you are considering using <code>StompDisk</code> to cover up evidence of illegal activity, then don't. In any case you should read the <a href="http://github.com/Ian-Parberry/stompdisk/blob/main/LICENSE">license</a> before the thought of using <code>StompDisk</code> even considers the possibility of crossing your mind.</span></p>
<p ><span style="color: red;"></span> </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Jun 7 2022 18:12:41 for StompDisk by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
